#####################################################################
#   TMC 2209 Stepper Driver Settings - OPTIMIZED for MOONS Motors
#   Voron 2.4 R2 350mm
#####################################################################

#####################################################################
#   X/Y Motors - Moons MS17HD6P420I-04 (NEMA17, 2.0A rated)
#   Specs: 2.0A rated, 1.8° step angle, 0.42Nm holding torque
#####################################################################

[tmc2209 stepper_x]
uart_pin: PC4
interpolate: false                 # Kein Interpolation bei 32 Microsteps
run_current: 1.4                   # 70% von 2.0A Rating (optimal für Performance)
sense_resistor: 0.110
stealthchop_threshold: 0           # SpreadCycle only für beste Torque
driver_TBL: 2                      # Blank Time (2 = optimal für schnelle Bewegungen)
driver_TOFF: 3                     # Off Time (3 = optimal für SpreadCycle)
driver_HEND: 0                     # Hysteresis End (0 für Performance)
driver_HSTRT: 5                    # Hysteresis Start (5 für smooth operation)
driver_PWM_AUTOGRAD: True          # Automatische PWM Anpassung
driver_PWM_AUTOSCALE: True         # Automatische Strom-Skalierung
driver_PWM_LIM: 12                 # PWM Limit (12 = optimal)
driver_PWM_REG: 8                  # PWM Regulation (8 = smooth)
driver_PWM_FREQ: 1                 # PWM Frequenz (1 = 2/1024 fclk)
driver_PWM_GRAD: 14                # PWM Gradient (14 = optimal für smooth)
driver_PWM_OFS: 36                 # PWM Offset (36 = optimal)

[tmc2209 stepper_y]
uart_pin: PD11
interpolate: false
run_current: 1.4                   # 70% von 2.0A Rating
sense_resistor: 0.110
stealthchop_threshold: 0
driver_TBL: 2
driver_TOFF: 3
driver_HEND: 0
driver_HSTRT: 5
driver_PWM_AUTOGRAD: True
driver_PWM_AUTOSCALE: True
driver_PWM_LIM: 12
driver_PWM_REG: 8
driver_PWM_FREQ: 1
driver_PWM_GRAD: 14
driver_PWM_OFS: 36

#####################################################################
#   Z Motors - Moons MS17HD6P420I-04 (NEMA17, 2.0A rated)
#   Silent Mode für Z-Achse (StealthChop für leisen Betrieb)
#####################################################################

[tmc2209 stepper_z]
uart_pin: PC6
interpolate: false
run_current: 1.0                   # 50% von 2.0A (Z braucht weniger Strom)
sense_resistor: 0.110
stealthchop_threshold: 999999      # Immer StealthChop für leisen Z-Betrieb
driver_TBL: 1                      # Blank Time (1 für StealthChop)
driver_TOFF: 3
driver_HEND: 2                     # Höhere Hysteresis für smooth Z
driver_HSTRT: 5
driver_PWM_AUTOGRAD: True
driver_PWM_AUTOSCALE: True
driver_PWM_LIM: 12
driver_PWM_REG: 8
driver_PWM_FREQ: 1
driver_PWM_GRAD: 14
driver_PWM_OFS: 36

[tmc2209 stepper_z1]
uart_pin: PC7
interpolate: false
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 999999
driver_TBL: 1
driver_TOFF: 3
driver_HEND: 2
driver_HSTRT: 5
driver_PWM_AUTOGRAD: True
driver_PWM_AUTOSCALE: True
driver_PWM_LIM: 12
driver_PWM_REG: 8
driver_PWM_FREQ: 1
driver_PWM_GRAD: 14
driver_PWM_OFS: 36

[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: false
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 999999
driver_TBL: 1
driver_TOFF: 3
driver_HEND: 2
driver_HSTRT: 5
driver_PWM_AUTOGRAD: True
driver_PWM_AUTOSCALE: True
driver_PWM_LIM: 12
driver_PWM_REG: 8
driver_PWM_FREQ: 1
driver_PWM_GRAD: 14
driver_PWM_OFS: 36

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: false
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 999999
driver_TBL: 1
driver_TOFF: 3
driver_HEND: 2
driver_HSTRT: 5
driver_PWM_AUTOGRAD: True
driver_PWM_AUTOSCALE: True
driver_PWM_LIM: 12
driver_PWM_REG: 8
driver_PWM_FREQ: 1
driver_PWM_GRAD: 14
driver_PWM_OFS: 36

#####################################################################
#   Extruder Motor - Moons CSE14HRA1L410A (NEMA14 Pancake, 1.0A rated)
#   Specs: 1.0A rated, 1.8° step angle, 0.1Nm holding torque
#####################################################################

[tmc2209 extruder]
uart_pin: PE1
interpolate: false
run_current: 0.6                   # 60% von 1.0A (optimal für NEMA14 Pancake)
sense_resistor: 0.110
stealthchop_threshold: 0           # SpreadCycle für präzise Extrusion
driver_TBL: 2
driver_TOFF: 3
driver_HEND: 0
driver_HSTRT: 5
driver_PWM_AUTOGRAD: True
driver_PWM_AUTOSCALE: True
driver_PWM_LIM: 12
driver_PWM_REG: 8
driver_PWM_FREQ: 1
driver_PWM_GRAD: 14
driver_PWM_OFS: 36

#####################################################################
#   Moons Motor Specifications
#####################################################################

# Moons MS17HD6P420I-04 (X/Y/Z):
# - Rated Current: 2.0A
# - Holding Torque: 0.42 Nm (59.5 oz-in)
# - Resistance: 1.1 Ohm ±10%
# - Inductance: 2.5 mH ±20%
# - Step Angle: 1.8° (200 steps/rev)
# - Weight: 350g
# - Optimal Current: 1.4A (70%)

# Moons CSE14HRA1L410A (Extruder):
# - Rated Current: 1.0A
# - Holding Torque: 0.1 Nm (14 oz-in)
# - Resistance: 2.4 Ohm ±10%
# - Inductance: 3.6 mH ±20%
# - Step Angle: 1.8° (200 steps/rev)
# - Height: 20mm (Pancake)
# - Optimal Current: 0.6A (60%)

#####################################################################
#   Wichtige Hinweise
#####################################################################

# Run Current Einstellungen für Moons Motoren:
# - X/Y: 1.4A (70% von 2.0A) - Maximum Performance
# - Z:   1.0A (50% von 2.0A) - Silent & Ausreichend
# - E:   0.6A (60% von 1.0A) - Optimal für NEMA14 Pancake

# StealthChop vs SpreadCycle:
# - X/Y: SpreadCycle (stealthchop_threshold: 0) - Beste Präzision
# - Z:   StealthChop (stealthchop_threshold: 999999) - Leise
# - E:   SpreadCycle - Präzise Extrusion

# Temperatur Monitoring:
# - Moons MS17HD6P420I-04: Max 80°C (optimal: 40-60°C)
# - Moons CSE14HRA1L410A: Max 80°C (optimal: 40-55°C)
# - Bei Überhitzung: Run Current reduzieren
