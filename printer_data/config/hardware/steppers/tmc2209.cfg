#####################################################################
#   TMC 2209 Stepper Driver Settings - OPTIMIZED
#   Voron 2.4 R2 350mm - Maximum Performance & Smoothness
#####################################################################

#####################################################################
#   X/Y Motors - LDO 42STH48-2004MAH (2.0A High-Torque)
#####################################################################

[tmc2209 stepper_x]
uart_pin: PC4
interpolate: false                 # Kein Interpolation bei 32 Microsteps
run_current: 1.4                   # 70% von 2.0A Rating (optimal für Performance)
sense_resistor: 0.110
stealthchop_threshold: 0           # SpreadCycle only für beste Torque
driver_TBL: 2                      # Blank Time (2 = optimal für schnelle Bewegungen)
driver_TOFF: 3                     # Off Time (3 = optimal für SpreadCycle)
driver_HEND: 0                     # Hysteresis End (0 für Performance)
driver_HSTRT: 5                    # Hysteresis Start (5 für smooth operation)
driver_PWM_AUTOGRAD: True          # Automatische PWM Anpassung
driver_PWM_AUTOSCALE: True         # Automatische Strom-Skalierung
driver_PWM_LIM: 12                 # PWM Limit (12 = optimal)
driver_PWM_REG: 8                  # PWM Regulation (8 = smooth)
driver_PWM_FREQ: 1                 # PWM Frequenz (1 = 2/1024 fclk)
driver_PWM_GRAD: 14                # PWM Gradient (14 = optimal für smooth)
driver_PWM_OFS: 36                 # PWM Offset (36 = optimal)

[tmc2209 stepper_y]
uart_pin: PD11
interpolate: false
run_current: 1.4                   # 70% von 2.0A Rating
sense_resistor: 0.110
stealthchop_threshold: 0
driver_TBL: 2
driver_TOFF: 3
driver_HEND: 0
driver_HSTRT: 5
driver_PWM_AUTOGRAD: True
driver_PWM_AUTOSCALE: True
driver_PWM_LIM: 12
driver_PWM_REG: 8
driver_PWM_FREQ: 1
driver_PWM_GRAD: 14
driver_PWM_OFS: 36

#####################################################################
#   Z Motors - LDO 42STH48-2004AC (2.0A)
#   Silent Mode für Z-Achse (weniger wichtig für Geschwindigkeit)
#####################################################################

[tmc2209 stepper_z]
uart_pin: PC6
interpolate: false
run_current: 1.0                   # 50% von 2.0A (Z braucht weniger Strom)
sense_resistor: 0.110
stealthchop_threshold: 999999      # Immer StealthChop für leisen Z-Betrieb
driver_TBL: 1                      # Blank Time (1 für StealthChop)
driver_TOFF: 3
driver_HEND: 2                     # Höhere Hysteresis für smooth Z
driver_HSTRT: 5
driver_PWM_AUTOGRAD: True
driver_PWM_AUTOSCALE: True
driver_PWM_LIM: 12
driver_PWM_REG: 8
driver_PWM_FREQ: 1
driver_PWM_GRAD: 14
driver_PWM_OFS: 36

[tmc2209 stepper_z1]
uart_pin: PC7
interpolate: false
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 999999
driver_TBL: 1
driver_TOFF: 3
driver_HEND: 2
driver_HSTRT: 5
driver_PWM_AUTOGRAD: True
driver_PWM_AUTOSCALE: True
driver_PWM_LIM: 12
driver_PWM_REG: 8
driver_PWM_FREQ: 1
driver_PWM_GRAD: 14
driver_PWM_OFS: 36

[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: false
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 999999
driver_TBL: 1
driver_TOFF: 3
driver_HEND: 2
driver_HSTRT: 5
driver_PWM_AUTOGRAD: True
driver_PWM_AUTOSCALE: True
driver_PWM_LIM: 12
driver_PWM_REG: 8
driver_PWM_FREQ: 1
driver_PWM_GRAD: 14
driver_PWM_OFS: 36

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: false
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 999999
driver_TBL: 1
driver_TOFF: 3
driver_HEND: 2
driver_HSTRT: 5
driver_PWM_AUTOGRAD: True
driver_PWM_AUTOSCALE: True
driver_PWM_LIM: 12
driver_PWM_REG: 8
driver_PWM_FREQ: 1
driver_PWM_GRAD: 14
driver_PWM_OFS: 36

#####################################################################
#   Extruder Motor - LDO 36STH20-1004AHG (1.0A Pancake)
#####################################################################

[tmc2209 extruder]
uart_pin: PE1
interpolate: false
run_current: 0.6                   # 60% von 1.0A (optimal für Clockwork 2)
sense_resistor: 0.110
stealthchop_threshold: 0           # SpreadCycle für präzise Extrusion
driver_TBL: 2
driver_TOFF: 3
driver_HEND: 0
driver_HSTRT: 5
driver_PWM_AUTOGRAD: True
driver_PWM_AUTOSCALE: True
driver_PWM_LIM: 12
driver_PWM_REG: 8
driver_PWM_FREQ: 1
driver_PWM_GRAD: 14
driver_PWM_OFS: 36

#####################################################################
#   TMC Driver Features
#####################################################################

# CoolStep (für X/Y) - Energie sparen bei geringer Last
# Wird automatisch durch TMC Autotune konfiguriert

# StallGuard (für Sensorless Homing)
# Aktuell mit Hardware-Endschaltern, kann später aktiviert werden

#####################################################################
#   Wichtige Hinweise
#####################################################################

# Run Current Einstellungen:
# - X/Y: 1.4A (70% von 2.0A) - Maximum Performance
# - Z:   1.0A (50% von 2.0A) - Silent & Ausreichend
# - E:   0.6A (60% von 1.0A) - Optimal für Clockwork 2

# StealthChop vs SpreadCycle:
# - X/Y: SpreadCycle (stealthchop_threshold: 0) - Beste Präzision
# - Z:   StealthChop (stealthchop_threshold: 999999) - Leise
# - E:   SpreadCycle - Präzise Extrusion

# Temperatur Monitoring:
# - Bei Überhitzung (>100°C): Run Current reduzieren
# - Optimal: 40-60°C bei Druck
# - Mit diesen Settings: 50-70°C erwartet
