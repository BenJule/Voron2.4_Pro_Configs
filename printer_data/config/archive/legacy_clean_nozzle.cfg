# ========================================================================
# LEGACY CLEAN_NOZZLE - Fallback for existing Print_Start
# Simple version to prevent "Unknown command" errors
# ========================================================================

[gcode_macro CLEAN_NOZZLE]
description: Simple nozzle cleaning fallback
gcode:
  # Call our smart system with PLA defaults
  CLEAN_NOZZLE_SMART MATERIAL=PLA

# Alternative: Basic cleaning without smart features (if CLEAN_NOZZLE_SMART fails)
[gcode_macro CLEAN_NOZZLE_BASIC]
description: Basic nozzle cleaning without smart features
variable_start_x: 35
variable_start_y: 358
variable_start_z: 4
variable_wipe_dist: 50
variable_wipe_qty: 3
variable_wipe_spd: 150
variable_wipe_y_offset: 2
variable_purge_length: 15
variable_purge_speed: 5
variable_retract_length: 3
variable_retract_speed: 25

gcode:
  # Safety check
  {% if printer.toolhead.homed_axes != "xyz" %}
    G28
  {% endif %}
  
  # Save current temp
  {% set original_temp = printer.extruder.target %}
  
  M117 Cleaning Nozzle
  
  # Position for cleaning
  G90
  M83
  G1 X{start_x} Y{start_y} F6000
  G1 Z{start_z} F1500
  
  # Small purge
  G1 Z{start_z + 2} F1500
  G92 E0
  G1 E{purge_length} F{purge_speed * 60}
  G92 E0
  G1 Z{start_z} F1500
  
  # Wipe sequence
  {% for i in range(wipe_qty) %}
    {% set y_pos = start_y + (i * wipe_y_offset) %}
    G1 X{start_x + wipe_dist} Y{y_pos} F{wipe_spd * 60}
    {% if i < (wipe_qty - 1) %}
      G1 X{start_x} Y{y_pos + wipe_y_offset} F{wipe_spd * 60}
    {% endif %}
  {% endfor %}
  
  # Retract and raise
  G1 E-{retract_length} F{retract_speed * 60}
  G1 Z{start_z + 15} F1500
  
  M117 Cleaning Complete