[sensor powermeter]
type: mqtt
name: Shelly 1PM
parameter_power:
  units=W
parameter_voltage:
  units=V
parameter_current:
  units=A
parameter_energy:
  units=kWh
state_topic: shellyplus1pm-voron/status/switch:0
state_response_template:
  {% set notification = payload|fromjson %}
  {set_result("power", notification["apower"]|float)}
  {set_result("voltage", notification["voltage"]|float)}
  {set_result("current", notification["current"]|float)}
  {set_result("energy", notification["aenergy"]["total"]|float / 1000)}
history_field_energy_consumption:
  parameter=energy
  desc=Energy consumption
  strategy=delta
  units=kWh
  init_tracker=true
  precision=6
  exclude_paused=false
  report_total=true
  report_maximum=true
history_field_average_power:
  parameter=power
  desc=Average power draw
  strategy=average
  units=W
  report_total=false
  report_maximum=true
history_field_max_power:
  parameter=power
  desc=Maximum power draw
  strategy=maximum
  units=W
  init_tracker=true
  report_total=false
  report_maximum=false
history_field_average_current:
  parameter=current
  desc=Average current draw
  strategy=average
  units=A
  report_total=false
  report_maximum=true
history_field_max_current:
  parameter=current
  desc=Maximum current draw
  strategy=maximum
  units=A
  init_tracker=true
  report_total=false
  report_maximum=false
